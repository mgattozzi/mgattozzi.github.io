<!DOCTYPE html>
<html>

    <head>
<meta charset="" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expect the Unexpected</title>
<meta name="description" content="Personal musings and coding">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/css/highlightjs.piperita.css">
<link rel="stylesheet" href="/css/syntax.css">

<!-- Favicons generated at http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="shortcut icon" href="/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5585bbce13b7da7c"></script>

</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>alloc(my_mind)</p>
    <ul class="pages">
      <li><a href="/"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="/posts/"><i class="fa fa-archive"></i> All Posts</a></li>
      <li><a href="/search/"><i class="fa fa-search"></i> Search</a></li>
    </ul>
    <p class="links">
      <a href="http://www.twitter.com/mgattozzi" target="_new"><i class="fa fa-twitter"></i></a>
      <a href="https://www.linkedin.com/in/mgattozzi" target="_new"><i class="fa fa-linkedin"></i></a>
      <a href="https://plus.google.com/+MichaelGattozzi/" target="_new"><i class="fa fa-google-plus"></i></a>
      <a href="https://github.com/mgattozzi" target="_new"><i class="fa fa-github-alt"></i></a>
      <a href="https://stackoverflow.com/users/2698054/mgattozzi?tab=profile" target="_new"><i class="fa fa-stack-overflow"></i></a>
      <a href="http://www.jacobtomlinson.co.uk/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
    </p>
  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>


    <div class="page-content">
      <div class="wrap">
      
  
  


<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="http://schema.org/Article" class="col-md-12 article">
      

      <h1 class="header" itemprop="name">Expect the Unexpected</h1>

      <div class="author">
        <small><i>
          by
          <span itemprop="author">
            
              <a rel="author" href="https://plus.google.com/+MichaelGattozzi/">
            
            
            
              </a>
            
          </span>
          on <span itemprop="datePublished" content="2014-08-28">July 11, 2015</span>
          under rust
        </i></small>
      </div>

      <div class="read-time">
        <small>
          4 minute read
        </small>
      </div>

      <div class="content-panel content">
        <span itemprop="articleBody"><p>Let's face it unwrap() is really nice for writing quick dirty code in Rust.
There are times when we just know as the programmer that we will always get
something, Result and Option be damned. However, what if we're wrong? Look at
the following code (an excerpt from my shell code):</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="k">pub</span> <span class="k">fn</span> <span class="n">check_alias</span><span class="p">(</span><span class="n">input</span><span class="o">:</span> <span class="n">Vec</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//Checks if alias is in config file and returns the altered</span>
    <span class="c1">//version as an Option of the input. If succesfully found</span>
    <span class="c1">//it can be unwraped for execution</span>

    <span class="c1">//Makes sure there is something to execute</span>
    <span class="k">if</span> <span class="n">input</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Sets the alias to check for</span>
    <span class="kd">let</span> <span class="n">alias_key</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

    <span class="c1">//Check the config file for the key</span>
    <span class="kd">let</span> <span class="n">config</span> <span class="o">=</span> <span class="n">read_in_config</span><span class="p">();</span>
    <span class="kd">let</span> <span class="k">mut</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">Parser</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">).</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
    <span class="kd">let</span> <span class="n">alias_table</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;alias&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Add an [alias] field to your config&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">alias_table</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">alias_key</span><span class="p">);</span>

    <span class="c1">//Checks if alias is in config file</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">alias</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="n">output</span><span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">alias</span><span class="p">.</span><span class="n">unwrap</span><span class="p">().</span><span class="n">to_owned</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
    <span class="nb">Some</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>


<p>I count four uses of unwrap() within that function. What if I'm testing this
code out and for some reason it panics. All I know is that I unwrapped a None
or Err type. I don't know which one it is, nor do I know how to go about fixing
it until I find out which unwrap() messed it up. How could this be avoided in
the future and made easier to pinpoint? I surely don't want to give up the
convenience of unwrap() in places where I feel sure the code won't mess up, yet
having a safety net in place would save me in the future in case Rust's std
library or something I use changes the way it operates.</p>

<p>Enter the expect() function.</p>

<h3>Expecting possible failure</h3>

<p>Recently Rust Nightly added the ability for Result types to use expect() not
just Option types. Let's edit the above snippet to use expect() instead of
unwrap():</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">feature</span><span class="p">(</span><span class="n">result_expect</span><span class="p">)]</span> <span class="c1">//Necessary for results to use at present time</span>
<span class="c1">//Other code to make the function work since line above is at top of file</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">check_alias</span><span class="p">(</span><span class="n">input</span><span class="o">:</span> <span class="n">Vec</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//Checks if alias is in config file and returns the altered</span>
    <span class="c1">//version as an Option of the input. If succesfully found</span>
    <span class="c1">//it can be unwraped for execution</span>

    <span class="c1">//Makes sure there is something to execute</span>
    <span class="k">if</span> <span class="n">input</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Sets the alias to check for</span>
    <span class="kd">let</span> <span class="n">alias_key</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Somehow there was no input&quot;</span><span class="p">);</span>

    <span class="c1">//Check the config file for the key</span>
    <span class="kd">let</span> <span class="n">config</span> <span class="o">=</span> <span class="n">read_in_config</span><span class="p">();</span>
    <span class="kd">let</span> <span class="k">mut</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">Parser</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">).</span><span class="n">parse</span><span class="p">()</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;No config available&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias_table</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;alias&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Add an [alias] field to your config&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">alias_table</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">alias_key</span><span class="p">);</span>

    <span class="c1">//Checks if alias is in config file</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">alias</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="n">output</span><span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">alias</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Should be available alias&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">to_owned</span><span class="p">())</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Should decode value into a string&quot;</span><span class="p">);</span>
    <span class="nb">Some</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>


<p>It didn't take that much work and still does the same thing as unwrap() with
the added benefit that if it fails I know exactly which expect() call to blame
and from there I can figure out the source of the error. This makes the code
slightly more robust and a better choice than unwrap() in one's code if hunting
down a bug that occurs later on. The payoff is worth the extra few keystrokes.
Especially in code bases with thousands of lines of code.</p>

<h3>Conclusion</h3>

<p>Unless doing a quick example for someone with snippets of code one should opt
to use expect() over unwrap() as it'll allow for more robust code and easier
debugging.</p>
</span>

        
        <div class="share">
          <!-- Go to www.addthis.com/dashboard to customize your tools -->
          <div class="addthis_sharing_toolbox"></div>
        </div>
        

        <div class="tags"><small>
          <i class="fa fa-tags"></i>
            error-handling, rust
        </small></div>

      </div>

      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="http://www.twitter.com/mgattozzi">@mgattozzi</a> or leave a comment below!
      </div>

      
      <div class="content-panel comments">
        <div id="disqus_thread">
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
      </div>
      

      <div class="content-panel related clearfix">
        
        <div class="related-header">
          <a href="/rust/2015/06/20/Rusty/">Read More</a>
        </div>
          <div class="title">
            <a href="/rust/2015/06/20/Rusty/">Rusty</a>
          </div>
          <div class="excerpt">
            Over the past few weeks I've had the great pleasure of working on my own shell in the Rust language. It's been exciting to work on and I've learned a...
            <a href="/rust/2015/06/20/Rusty/">Continue Reading</a>
          </div>
        
        <hr />
        <div class="previous previous-next">
          
          <p>
            <a href="/rust/2015/06/20/Rusty/">Rusty</a>
          </p>
          <p class="date">Published June 20, 2015</p>
          
        </div>
        <div class="next previous-next">
          
        </div>
      </div>

    </div>

  </div>

</div>


<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
function disqus_config() { this.experiment.enable_scroll_container = true; }
var disqus_shortname = "mgattozzi"; // required: replace example with your forum shortname
/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>


      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-6">
    Made with carte-noire theme by <a href="https://twitter.com/_JacobTomlinson">Jacob Tomlinson</a>
  </div>
  <div class="col-md-6">
    &lt;/&gt; on <a href="https://github.com/jacobtomlinson/carte-noire">Github</a> &nbsp;<i class="fa fa-github-alt"></i>
  </div>
</div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/js/jquery.mmenu.min.all.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38312845-2']);
          _gaq.push(['_trackPageview']);
  (function () {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
  })();
</script>



    </body>
</html>
