<p>Let’s face it unwrap() is really nice for writing quick dirty code in Rust.
There are times when we just know as the programmer that we will always get
something, Result and Option be damned. However, what if we’re wrong? Look at
the following code (an excerpt from my shell code):</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="k">pub</span> <span class="k">fn</span> <span class="n">check_alias</span><span class="p">(</span><span class="n">input</span><span class="o">:</span> <span class="n">Vec</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//Checks if alias is in config file and returns the altered</span>
    <span class="c1">//version as an Option of the input. If succesfully found</span>
    <span class="c1">//it can be unwraped for execution</span>

    <span class="c1">//Makes sure there is something to execute</span>
    <span class="k">if</span> <span class="n">input</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Sets the alias to check for</span>
    <span class="kd">let</span> <span class="n">alias_key</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

    <span class="c1">//Check the config file for the key</span>
    <span class="kd">let</span> <span class="n">config</span> <span class="o">=</span> <span class="n">read_in_config</span><span class="p">();</span>
    <span class="kd">let</span> <span class="k">mut</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">Parser</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">).</span><span class="n">parse</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
    <span class="kd">let</span> <span class="n">alias_table</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;alias&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Add an [alias] field to your config&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">alias_table</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">alias_key</span><span class="p">);</span>

    <span class="c1">//Checks if alias is in config file</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">alias</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="n">output</span><span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">alias</span><span class="p">.</span><span class="n">unwrap</span><span class="p">().</span><span class="n">to_owned</span><span class="p">()).</span><span class="n">unwrap</span><span class="p">();</span>
    <span class="nb">Some</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>I count four uses of unwrap() within that function. What if I’m testing this
code out and for some reason it panics. All I know is that I unwrapped a None
or Err type. I don’t know which one it is, nor do I know how to go about fixing
it until I find out which unwrap() messed it up. How could this be avoided in
the future and made easier to pinpoint? I surely don’t want to give up the
convenience of unwrap() in places where I feel sure the code won’t mess up, yet
having a safety net in place would save me in the future in case Rust’s std
library or something I use changes the way it operates.</p>

<p>Enter the expect() function.</p>

<h3 id="expecting-possible-failure">Expecting possible failure</h3>
<p>Recently Rust Nightly added the ability for Result types to use expect() not
just Option types. Let’s edit the above snippet to use expect() instead of
unwrap():</p>

<div class="highlight"><pre><code class="language-rust" data-lang="rust"><span class="err">#</span><span class="o">!</span><span class="p">[</span><span class="n">feature</span><span class="p">(</span><span class="n">result_expect</span><span class="p">)]</span> <span class="c1">//Necessary for results to use at present time</span>
<span class="c1">//Other code to make the function work since line above is at top of file</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="n">check_alias</span><span class="p">(</span><span class="n">input</span><span class="o">:</span> <span class="n">Vec</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">//Checks if alias is in config file and returns the altered</span>
    <span class="c1">//version as an Option of the input. If succesfully found</span>
    <span class="c1">//it can be unwraped for execution</span>

    <span class="c1">//Makes sure there is something to execute</span>
    <span class="k">if</span> <span class="n">input</span><span class="p">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">//Sets the alias to check for</span>
    <span class="kd">let</span> <span class="n">alias_key</span> <span class="o">=</span> <span class="n">input</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Somehow there was no input&quot;</span><span class="p">);</span>

    <span class="c1">//Check the config file for the key</span>
    <span class="kd">let</span> <span class="n">config</span> <span class="o">=</span> <span class="n">read_in_config</span><span class="p">();</span>
    <span class="kd">let</span> <span class="k">mut</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">Parser</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">config</span><span class="p">).</span><span class="n">parse</span><span class="p">()</span>
		<span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;No config available&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias_table</span> <span class="o">=</span> <span class="n">parsed</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;alias&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Add an [alias] field to your config&quot;</span><span class="p">);</span>
    <span class="kd">let</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">alias_table</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">alias_key</span><span class="p">);</span>

    <span class="c1">//Checks if alias is in config file</span>
    <span class="k">if</span> <span class="o">!</span><span class="n">alias</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">None</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="n">output</span><span class="o">:</span> <span class="n">String</span> <span class="o">=</span> <span class="n">toml</span><span class="o">::</span><span class="n">decode</span><span class="p">(</span><span class="n">alias</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Should be available alias&quot;</span><span class="p">)</span>
		<span class="p">.</span><span class="n">to_owned</span><span class="p">())</span>
		<span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">&quot;Should decode value into a string&quot;</span><span class="p">);</span>
    <span class="nb">Some</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>

<p>It didn’t take that much work and still does the same thing as unwrap() with
the added benefit that if it fails I know exactly which expect() call to blame
and from there I can figure out the source of the error. This makes the code
slightly more robust and a better choice than unwrap() in one’s code if hunting
down a bug that occurs later on. The payoff is worth the extra few keystrokes.
Especially in code bases with thousands of lines of code.</p>

<h3 id="conclusion">Conclusion</h3>
<p>Unless doing a quick example for someone with snippets of code one should opt
to use expect() over unwrap() as it’ll allow for more robust code and easier
debugging.</p>
